# π“ 6μ¥ λ©”μ‹μ§€μ™€ μΈν„°νμ΄μ¤

> μ• ν”λ¦¬μΌ€μ΄μ…μ€ ν΄λμ¤λ΅ κµ¬μ„±λμ§€λ§ λ©”μ‹μ§€λ¥Ό ν†µν•΄ μ •μλλ‹¤λ” μ‚¬μ‹¤μ„ κΈ°μ–µν•λΌ.

## π“– 6.1 ν‘λ ¥κ³Ό λ©”μ‹μ§€

### π”– 6.1.1 ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ λ¨λΈ

λ©”μ‹μ§€λ” κ°μ²΄ μ‚¬μ΄μ ν‘λ ¥μ„ κ°€λ¥ν•κ² ν•λ” λ§¤κ°μ²΄λ‹¤. λ‘ κ°μ²΄ μ‚¬μ΄μ ν‘λ ¥ κ΄€κ³„λ¥Ό μ„¤λ…ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” μ „ν†µμ μΈ λ©”νƒ€ν¬λ” **ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ λ¨λΈ** μ΄λ‹¤.

- `Movie`μ™€ κ°™μ΄ κ°μ²΄λ” ν‘λ ¥μ— μ°Έμ—¬ν•λ” λ™μ• ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„μ μ—­ν• μ„ λ™μ‹μ— μν–‰ν•λ” κ²ƒμ΄ μΌλ°μ 
- ν‘λ ¥μ κ΄€μ μ—μ„ κ°μ²΄λ” λ‘ κ°€μ§€ μΆ…λ¥μ λ©”μ‹μ§€ μ§‘ν•©μΌλ΅ κµ¬μ„±
  - κ°μ²΄κ°€ μμ‹ ν•λ” λ©”μ‹μ§€μ μ§‘ν•©
  - μ™Έλ¶€μ κ°μ²΄μ—κ² μ „μ†΅ν•λ” λ©”μ‹μ§€μ μ§‘ν•©
- λ‘ κ°μ²΄ μ‚¬μ΄μ ν‘λ ¥μ„ κ°€λ¥ν•κ² ν•΄μ£Όλ” λ§¤κ°μ²΄κ°€ λ©”μ‹μ§€

### π”– 6.1.2 λ©”μ‹μ§€μ™€ λ©”μ‹μ§€ μ „μ†΅

- λ©”μ‹μ§€λ” κ°μ²΄λ“¤μ΄ ν‘λ ¥ν•κΈ° μ„ν•΄ μ‚¬μ©ν•  μ μλ” μ μΌν• μμ‚¬μ†ν†µ μλ‹¨
- **λ©”μ‹μ§€ μ „μ†΅(λ©”μ‹μ§€ ν¨μ‹±)**: ν• κ°μ²΄κ°€ λ‹¤λ¥Έ κ°μ²΄μ—κ² λ„μ›€μ„ μ”μ²­ν•λ” κ²ƒ
- **λ©”μ‹μ§€ μ „μ†΅μ(ν΄λΌμ΄μ–ΈνΈ)**: λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ” κ°μ²΄
- **λ©”μ‹μ§€ μμ‹ μ(μ„λ²„)**: λ©”μ‹μ§€λ¥Ό μμ‹ ν•λ” κ°μ²΄
- λ©”μ‹μ§€λ” **μ¤νΌλ μ΄μ…λ…**κ³Ό **μΈμ**λ΅ κµ¬μ„±
  - λ©”μ‹μ§€ μ „μ†΅μ€ μ—¬κΈ°μ— **λ©”μ‹μ§€ μμ‹ μ**λ¥Ό μ¶”κ°€ν• κ²ƒ

### π”– 6.1.3 λ©”μ‹μ§€μ™€ λ©”μ„λ“

- λ©”μ‹μ§€λ¥Ό μμ‹ ν–μ„ λ• μ‹¤μ λ΅ μ‹¤ν–‰λλ” ν•¨μ λλ” ν”„λ΅μ‹μ €λ¥Ό **λ©”μ„λ“**λΌκ³  λ¶€λ¥Έλ‹¤.
  - λ™μΌν• λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ”λΌλ„ κ°μ²΄μ νƒ€μ…μ— λ”°λΌ μ‹¤ν–‰λλ” λ©”μ„λ“κ°€ λ‹¬λΌμ§ μ μλ‹¤.
  - κ°μ²΄λ” λ©”μ‹μ§€μ™€ λ©”μ„λ“λΌλ” λ‘ κ°€μ§€ μ„λ΅ λ‹¤λ¥Έ κ°λ…μ„ μ‹¤ν–‰ μ‹μ μ— μ—°κ²°ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ— μ»΄νμΌ μ‹μ κ³Ό μ‹¤ν–‰ μ‹μ μ μλ―Έκ°€ λ‹¬λΌμ§ μ μλ‹¤.
- λ©”μ‹μ§€μ™€ λ©”μ„λ“μ κµ¬λ¶„μ€ λ©”μ‹μ§€ μ „μ†΅μμ™€ λ©”μ‹μ§€ μμ‹ μκ°€ λμ¨ν•κ² κ²°ν•©λ  μ μκ² ν•λ‹¤.
- μ‹¤ν–‰ μ‹μ μ— λ©”μ‹μ§€μ™€ λ©”μ„λ“λ¥Ό λ°”μΈλ”©ν•λ” λ©”μ»¤λ‹μ¦μ€ λ‘ κ°μ²΄ μ‚¬μ΄μ κ²°ν•©λ„λ¥Ό λ‚®μ¶¤μΌλ΅μ¨ μ μ—°ν•κ³  ν™•μ¥ κ°€λ¥ν• μ½”λ“λ¥Ό μ‘μ„±ν•  μ μκ² λ§λ“ λ‹¤.

### π”– 6.1.4 νΌλΈ”λ¦­ μΈν„°νμ΄μ¤μ™€ μ¤νΌλ μ΄μ…

- **νΌλΈ”λ¦­ μΈν„°νμ΄μ¤**: κ°μ²΄κ°€ μμ‚¬μ†ν†µμ„ μ„ν•΄ μ™Έλ¶€μ— κ³µκ°ν•λ” λ©”μ‹μ§€μ μ§‘ν•©
- **μ¤νΌλ μ΄μ…**: ν”„λ΅κ·Έλλ° μ–Έμ–΄μ κ΄€μ „μ—μ„ νΌλΈ”λ¦­ μΈν„°νμ΄μ¤μ— ν¬ν•¨λ λ©”μ‹μ§€
  - μν–‰ κ°€λ¥ν• μ–΄λ–¤ ν–‰λ™μ— λ€ν• μ¶”μƒν™”
  - UMLμ κ΄€μ μ—μ„ μ¤νΌλ μ΄μ…μ΄λ€ μ‹¤ν–‰ν•κΈ° μ„ν•΄ κ°μ²΄κ°€ νΈμ¶λ  μ μλ” λ³€ν™μ΄λ‚ μ •μμ— κ΄€ν• λ…μ„Έ

### π”– 6.1.5 μ‹κ·Έλ‹μ²

- **μ‹κ·Έλ‹μ²**: μ¤νΌλ μ΄μ…(λλ” λ©”μ„λ“)μ μ΄λ¦„κ³Ό νλΌλ―Έν„° λ©λ΅μ„ ν•©μΉ κ²ƒ
  - μ¤νΌλ μ΄μ…μ€ μ‹¤ν–‰ μ½”λ“ μ—†μ΄ μ‹κ·Έλ‹μ²λ§μ„ μ •μν• κ²ƒ
  - λ©”μ„λ“λ” μ΄ μ‹κ·Έλ‹μ²μ— κµ¬ν„μ„ λ”ν• κ²ƒ

## π“– 6.2 μΈν„°νμ΄μ¤μ™€ μ„¤κ³„ ν’μ§

μΆ‹μ€ μΈν„°νμ΄μ¤λ” **μµμ†ν•μ μΈν„°νμ΄μ¤**μ™€ **μ¶”μƒμ μΈ μΈν„°νμ΄μ¤**λΌλ” μ΅°κ±΄μ„ λ§μ΅±ν•΄μ•Ό ν•λ‹¤.

νΌλΈ”λ¦­ μΈν„°νμ΄μ¤μ ν’μ§μ— μν–¥μ„ λ―ΈμΉλ” μ›μΉ™κ³Ό κΈ°λ²•

- λ””λ―Έν„° λ²•μΉ™
- λ¬»μ§€ λ§κ³  μ‹μΌλΌ
- μλ„λ¥Ό λ“λ¬λ‚΄λ” μΈν„°νμ΄μ¤
- λ…λ Ή-μΏΌλ¦¬ λ¶„λ¦¬

### π”– 6.2.1 λ””λ―Έν„° λ²•μΉ™

```java
public class ReservationAgency {

    public Reservation reserve(Screening screening, Customer customer, int audienceCount) {
        Movie movie = screening.getMovie();

        boolean discountable = false;
        for (DiscountCondition condition : movie.getDiscountConditions()) {
            if (condition.getType() == DiscountConditionType.PERIOD) {
                discountable = screening.getWhenScreened().getDayOfWeek().equals(condition.getDayOfWeek()) &&
                        !condition.getStartTime().isAfter(screening.getWhenScreened().toLocalTime()) &&
                        !condition.getEndTime().isBefore(screening.getWhenScreened().toLocalTime());
            } else {
                discountable = condition.getSequence() == screening.getSequence();
            }

            if (discountable) {
                break;
            }
        }

        Money fee;
        if (discountable) {
            Money discountAmount = Money.ZERO;
            switch (movie.getMovieType()) {
                case AMOUNT_DISCOUNT -> discountAmount = movie.getDiscountAmount();
                case PERCENT_DISCOUNT -> discountAmount = movie.getFee().times(movie.getDiscountPercent());
                case NONE_DISCOUNT -> discountAmount = Money.ZERO;
            }

            fee = movie.getFee().minus(discountAmount);
        } else {
            fee = movie.getFee();
        }

        return new Reservation(customer, screening, fee, audienceCount);
    }
}
```

- μ„ μ½”λ“μ κ°€μ¥ ν° λ‹¨μ μ€ `ReservationAgency`μ™€ μΈμλ΅ μ „λ‹¬λ `Screening` μ‚¬μ΄μ κ²°ν•©λ„κ°€ λ„λ¬΄ λ†’μ€ κ²ƒμ΄λ‹¤.
- μ΄μ²λΌ ν‘λ ¥ν•λ” κ°μ²΄μ λ‚΄λ¶€ κµ¬μ΅°μ— λ€ν• κ²°ν•©μΌλ΅ μΈν•΄ λ°μƒν•λ” μ„¤κ³„ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ μ μ•λ μ›μΉ™μ΄ **λ””λ―Έν„° λ²•μΉ™**

> λ‚―μ„  μμ—κ² λ§ν•μ§€ λ§λΌ
>
> μ¤μ§ μΈμ ‘ν• μ΄μ›ƒν•κ³ λ§ λ§ν•λΌ

λ””λ―Έν„° λ²•μΉ™μ„ λ”°λ¥΄κΈ° μ„ν•΄μ„λ” ν΄λμ¤κ°€ νΉμ •ν• μ΅°κ±΄μ„ λ§μ΅±ν•λ” λ€μƒμ—κ²λ§ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ„λ΅ ν”„λ΅κ·Έλλ°

- λ¨λ“  ν΄λμ¤ Cμ™€ Cμ— κµ¬ν„λ λ¨λ“  λ©”μ„λ“ Mμ— λ€ν•΄μ„, Mμ΄ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•  μ μλ” λ¨λ“  κ°μ²΄λ” μ•„λ ν΄λμ¤μ μΈμ¤ν„΄μ¤μ—¬μ•Ό ν•λ‹¤.
  - Mμ μΈμλ΅ μ „λ‹¬λ ν΄λμ¤(C μμ²΄λ¥Ό ν¬ν•¨)
  - Cμ μΈμ¤ν„΄μ¤ λ³€μμ ν΄λμ¤
- Mμ— μν•΄ μƒμ„±λ κ°μ²΄λ‚ Mμ΄ νΈμ¶ν•λ” λ©”μ„λ“μ— μν•΄ μƒμ„±λ κ°μ²΄, μ „μ—­ λ³€μλ΅ μ„ μ–Έλ κ°μ²΄λ” λ¨λ‘ Mμ μΈμλ΅ κ°„μ£Ό

μ¦‰, ν΄λμ¤ λ‚΄λ¶€μ λ©”μ„λ“κ°€ μ•„λ μ΅°κ±΄μ„ λ§μ΅±ν•λ” μΈμ¤ν„΄μ¤μ—λ§ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ„λ΅ ν•΄μ•Ό ν•λ‹¤.

- this κ°μ²΄
- λ©”μ„λ“μ λ§¤κ°λ³€μ
- thisμ μ†μ„±
- thisμ μ†μ„±μΈ μ»¬λ ‰μ…μ μ”μ†
- λ©”μ„λ“ λ‚΄μ—μ„ μƒμ„±λ μ§€μ—­ κ°μ²΄

```java
public class ReservationAgency {

    public Reservation reserve(Screening screening, Customer customer, int audienceCount) {
        Money fee = screening.calculateFee(audienceCount);
        return new Reservation(customer, screening, fee, audienceCount);
    }
}
```

- λ””λ―Έν„° λ²•μΉ™μ„ λ”°λ¥Έ κ²°κ³Ό κ²°ν•¨μ΄ κ°μ„ λμ—λ‹¤.
- λ””λ―Έν„° λ²•μΉ™μ„ λ”°λ¥΄λ©΄ **λ¶€λ„λΌνƒ€λ” μ½”λ“(shy code)** λ¥Ό μ‘μ„±ν•  μ μλ‹¤.
  - λ¶ν•„μ”ν• μ–΄λ–¤ κ²ƒλ„ λ‹¤λ¥Έ κ°μ²΄μ—κ² λ³΄μ—¬μ£Όμ§€ μ•μ
  - λ‹¤λ¥Έ κ°μ²΄μ κµ¬ν„μ— μμ΅΄ν•μ§€ μ•λ” μ½”λ“

`screening.getMovie().getDiscountConditions();`

- μ„ μ½”λ“λ” λ””λ―Έν„° λ²•μΉ™μ„ μ„λ°ν• μ½”λ“λ‹¤.
- λ©”μ‹μ§€ μ „μ†΅μκ°€ μμ‹ μμ λ‚΄λ¶€ κµ¬μ΅°μ— λ€ν•΄ λ¬Όμ–΄λ³΄κ³  λ°ν™λ°›μ€ μ”μ†μ— λ€ν•΄ μ—°μ‡„μ μΌλ΅ λ©”μ‹μ§€λ¥Ό μ „μ†΅
- **κΈ°μ°¨ μ¶©λ(train wreck)**
  - μ—¬λ¬ λ€μ κΈ°μ°¨κ°€ ν• μ¤„λ΅ λμ–΄μ„ μ¶©λν• κ²ƒμ²λΌ λ³΄μ΄κΈ° λ•λ¬Έ
  - ν΄λμ¤μ λ‚΄λ¶€ κµ¬ν„μ΄ μ™Έλ¶€λ΅ λ…Έμ¶λμ„ λ• λ‚νƒ€λ‚λ” μ „ν•μ μΈ ν•νƒ
- λ””λ―Έν„° λ²•μΉ™μ„ μ μ©ν• μ½”λ“λ” `screening.calculateFee(audienceCount);`

λ¬΄λΉ„νμ μΌλ΅ λ””λ―Έν„° λ²•μΉ™μ„ μμ©ν•λ©΄ νΌλΈ”λ¦­ μΈν„°νμ΄μ¤ κ΄€μ μ—μ„ κ°μ²΄μ μ‘μ§‘λ„κ°€ λ‚®μ•„μ§ μλ„ μλ‹¤.

### π”– 6.2.2 λ¬»μ§€ λ§κ³  μ‹μΌλΌ

λ©”μ‹μ§€ μ „μ†΅μλ” λ©”μ‹μ§€ μμ‹ μμ μƒνƒλ¥Ό κΈ°λ°μΌλ΅ κ²°μ •μ„ λ‚΄λ¦° ν›„ λ©”μ‹μ§€ μμ‹ μμ μƒνƒλ¥Ό λ°”κΏ”μ„λ” μ•λλ‹¤.

- λ¬»μ§€ λ§κ³  μ‹μΌλΌ μ›μΉ™μ„ λ”°λ¥΄λ©΄ λ°€μ ‘ν•κ² μ—°κ΄€λ μ •λ³΄μ™€ ν–‰λ™μ„ ν•¨κ» κ°€μ§€λ” κ°μ²΄λ¥Ό λ§λ“¤ μ μλ‹¤.
- μƒνƒλ¥Ό λ¬»λ” μ¤νΌλ μ΄μ…μ„ ν–‰λ™μ„ μ”μ²­ν•λ” μ¤νΌλ μ΄μ…μΌλ΅ λ€μ²΄ν•¨μΌλ΅μ¨ μΈν„°νμ΄μ¤λ¥Ό ν–¥μƒμ‹μΌλΌ
- ν•μ§€λ§ λ‹¨μν•κ² κ°μ²΄μ—κ² λ¬»μ§€ μ•κ³  μ‹ν‚¨λ‹¤κ³  ν•΄μ„ λ¨λ“  λ¬Έμ κ°€ ν•΄κ²°λλ” κ²ƒμ€ μ•„λ‹λ‹¤.
  - ν›λ¥­ν• μΈν„°νμ΄μ¤λ¥Ό μν™•ν•κΈ° μ„ν•΄μ„λ” κ°μ²΄κ°€ μ–΄λ–»κ² μ‘μ—…μ„ μν–‰ν•λ”μ§€λ¥Ό λ…Έμ¶ν•΄μ„λ” μ• λλ‹¤.
  
### π”– 6.2.3 μλ„λ¥Ό λ“λ¬λ‚΄λ” μΈν„°νμ΄μ¤

λ©”μ„λ“λ¥Ό λ…λ…ν•λ” λ°©λ²•

```java
public class PeriodCondition {
    public boolean isSatisfiedByPeriod(Screening screening) {
        ...
    }
}

public class SequenceCondition {
    public boolean isSatisfiedBySequence(Screening screening) {
        ...
    }
}
```

1. λ©”μ„λ“κ°€ μ‘μ—…μ„ μ–΄λ–»κ² μν–‰ν•λ”μ§€λ¥Ό λ‚νƒ€λ‚΄λ„λ΅ μ΄λ¦„ μ§“λ” κ²ƒ
   - λ©”μ„λ“μ μ΄λ¦„μ€ λ‚΄λ¶€μ κµ¬ν„ λ°©λ²•μ„ λ“λ¬λ‚Έλ‹¤.
   - λ©”μ„λ“μ— λ€ν•΄ μ λ€λ΅ μ»¤λ®¤λ‹μΌ€μ΄μ…ν•μ§€ λ»ν•λ‹¤.
   - λ©”μ„λ“ μμ¤€μ—μ„ μΊ΅μν™”λ¥Ό μ„λ°ν•λ‹¤.
     - ν΄λΌμ΄μ–ΈνΈλ΅ ν•μ—¬κΈ ν‘λ ¥ν•λ” κ°μ²΄μ μΆ…λ¥λ¥Ό μ•λ„λ΅ κ°•μ”

2. 'μ–΄λ–»κ²'κ°€ μ•„λ‹λΌ 'λ¬΄μ—‡'μ„ ν•λ”μ§€λ¥Ό λ“λ¬λ‚΄λ” κ²ƒ
   - μ–΄λ–»κ² μν–‰ν•λ”μ§€λ¥Ό λ“λ¬λ‚΄λ” μ΄λ¦„μ΄λ€ λ©”μ„λ“μ λ‚΄λ¶€ κµ¬ν„μ„ μ„¤λ…ν•λ” μ΄λ¦„
   - λ¬΄μ—‡μ„ ν•λ”μ§€λ¥Ό λ“λ¬λ‚΄λ„λ΅ λ©”μ„λ“μ μ΄λ¦„μ„ μ§“κΈ° μ„ν•΄μ„λ” κ°μ²΄κ°€ ν‘λ ¥ μ•μ—μ„ μν–‰ν•΄μ•Ό ν•λ” μ±…μ„μ— κ΄€ν•΄ κ³ λ―Ό

```java
public class PeriodCondition {
    public boolean isSatisfiedBy(Screening screening) {
        ...
    }
}

public class SequenceCondition {
    public boolean isSatisfiedBy(Screening screening) {
        ...
    }
}
```

- μ„ μ½”λ“λ” μμ—°μ¤λ  μ•„λμ™€ κ°™μ΄ λ°”λ€λ‹¤.

```java
public interface DiscountCondtion {
    boolean isSatisfiedBy(Screening screening);
}
```

μ΄μ™€ κ°™μ€ λ©”μ„λ“ λ…λ… λ°©λ²•μ„ **μλ„λ¥Ό λ“λ¬λ‚΄λ” μ„ νƒμ(Intention Revealing Selector)** λΌκ³  λ¶€λ¥Έλ‹¤.

- μ—λ¦­ μ—λ°μ¤λ” μλ„λ¥Ό λ“λ¬λ‚΄λ” μ„ νƒμλ¥Ό μΈν„°νμ΄μ¤ λ λ²¨λ΅ ν™•μ¥ν• **μλ„λ¥Ό λ“λ¬λ‚΄λ” μΈν„°νμ΄μ¤(Intention Revealing Interface)**λ¥Ό μ μ‹
  - κµ¬ν„κ³Ό κ΄€λ ¨λ λ¨λ“  μ •λ³΄λ¥Ό μΊ΅μν™”ν•κ³  κ°μ²΄μ νΌλΈ”λ¦­ μΈν„°νμ΄μ¤μ—λ” ν‘λ ¥κ³Ό κ΄€λ ¨λ μλ„λ§μ„ ν‘ν„

### π”– 6.2.4 ν•¨κ» λ¨μΌκΈ°

#### π› οΈ 6.2.4.1 λ””λ―Έν„° λ²•μΉ™μ„ μ„λ°ν•λ” ν‹°μΌ“ νλ§¤ λ„λ©”μΈ

```java
@AllArgsConstructor
public class Theater {

    private TicketSeller ticketSeller;

    // κ΄€λκ° μ…μ¥
    public void enter(Audience audience) {
        if (audience.getBag().hasInvitation()) {
            Ticket ticket = ticketSeller.getTicketOffice().getTicket();
            audience.getBag().setTicket(ticket);
            return;
        }
        Ticket ticket = ticketSeller.getTicketOffice().getTicket();
        audience.getBag().minusAmount(ticket.getFee());
        ticketSeller.getTicketOffice().plusAmount(ticket.getFee());
        audience.getBag().setTicket(ticket);
        
    }
}
```

- λ””λ―Έν„° λ²•μΉ™μ„ μ„λ°ν• μ „ν•μ μΈ μ½”λ“
- **μΈν„°νμ΄μ¤μ™€ κµ¬ν„μ λ¶„λ¦¬ μ›μΉ™** μ„λ°
- λ¶μ•μ •ν•κ³ , μ‚¬μ©ν•κΈ° νλ“¤κ³ , ν΄λΌμ΄μ–ΈνΈμ—κ² κµ¬ν„μ„ λ…Έμ¶

#### π› οΈ 6.2.4.2 λ¬»μ§€ λ§κ³  μ‹μΌλΌ

```java
@AllArgsConstructor
public class TicketSeller {

    private TicketOffice ticketOffice;
    
    public void setTicket(Audience audience) {
        if (audience.getBag().hasInvitation()) {
            Ticket ticket = ticketOffice.getTicket();
            audience.getBag().setTicket(ticket);
            return;
        }
        Ticket ticket = ticketOffice.getTicket();
        audience.getBag().minusAmount(ticket.getFee());
        ticketOffice.plusAmount(ticket.getFee());
        audience.getBag().setTicket(ticket);
    }
}
```

```java
@AllArgsConstructor
public class Theater {

    private TicketSeller ticketSeller;

    public void enter(Audience audience) {
        ticketSeller.setTicket(audience);
    }
}
```

- `Theater`λ” `TicketSeller`μ™€ `Audience`μ λ‚΄λ¶€ κµ¬μ΅°μ— κ΄€ν•΄ λ¬»μ§€ λ§κ³  μ›ν•λ” μ‘μ—…μ„ μ‹μΌμ•Ό ν•λ‹¤.

```java
@AllArgsConstructor
public class Audience {

    private Bag bag;

    public Long setTicket(Ticket ticket) {
        if (bag.hasInvitation()) {
            bag.setTicket(ticket);
            return 0L;
        }
        bag.setTicket(ticket);
        bag.minusAmount(ticket.getFee());
        return ticket.getFee();
    }
}
```

```java
@AllArgsConstructor
public class TicketSeller {

    private TicketOffice ticketOffice;

    public void setTicket(Audience audience) {
        ticketOffice.plusAmount(audience.setTicket(ticketOffice.getTicket()));
    }
}
```

- `TicketSeller`λ” μ†μ„±μΌλ΅ ν¬ν•¨λκ³  μλ” `TicketOffice`μ μΈμ¤ν„΄μ¤μ™€ μΈμλ΅ μ „λ‹¬λ `Audience`μ—κ²λ§ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ‹¤.
- `Audience`λ” `hasInvitation` λ©”μ„λ“λ¥Ό μ΄μ©ν•΄ μ΄λ€κ¶μ„ κ°€μ§€κ³  μλ”μ§€λ¥Ό λ¬»λ”λ‹¤. μ¦‰, λ””λ―Έν„° λ²•μΉ™μ„ μ„λ°ν•λ‹¤.

```java
public class Bag {

    private Long amount;

    private Invitation invitation;

    private Ticket ticket;

    public Long setTicket(Ticket ticket) {
        if (hasInvitation()) {
            setTicket(ticket);
            return 0L;
        }
        setTicket(ticket);
        minusAmount(ticket.getFee());
        return ticket.getFee();
    }

    public boolean hasInvitation() {
        return invitation != null;
    }

    public void minusAmount(Long amount) {
        this.amount -= amount;
    }
}
```

```java
@AllArgsConstructor
public class Audience {

    private Bag bag;

    public Long setTicket(Ticket ticket) {
        return bag.setTicket(ticket);
    }
}
```

- `Audience`λ” μμ¨μ μΈ μ΅΄μ¬κ°€ λμ—λ‹¤.

λ””λ―Έν„° λ²•μΉ™κ³Ό λ¬»μ§€ λ§κ³  μ‹μΌλΌ μ¤νƒ€μΌμ„ λ”°λ¥΄λ©΄ μμ—°μ¤λ½κ² μμ¨μ μΈ κ°μ²΄λ΅ κµ¬μ„±λ μ μ—°ν• ν‘λ ¥μ„ μ–»κ² λλ‹¤.

#### π› οΈ 6.2.4.3 μΈν„°νμ΄μ¤μ— μλ„λ¥Ό λ“λ¬λ‚΄μ

μ„ μ½”λ“λ“¤μ `setTicket` λ©”μ„λ“λ” λ―Έλ¬ν•κ² λ‹¤λ¥Έ μλ―Έλ¥Ό κ°€μ§€κ³  μλ‹¤β—οΈ

```java
public class TicketSeller {
    public void sellTo(Audience audience) {
        ...
    }
}

public class Audience {
    public Long buy(Ticket ticket) {
        ...
    }
}

public class Bag {
    public Long hold(Ticket ticket) {
        ...
    }
}
```

- μ„ λ©”μ„λ“ λ…μΉ­μ€ ν΄λΌμ΄μ–ΈνΈκ°€ κ°μ²΄μ—κ² λ¬΄μ—‡μ„ μ›ν•λ”μ§€λ¥Ό λ…ν™•ν•κ² ν‘ν„

## π“– 6.3 μ›μΉ™μ ν•¨μ •

μ›μΉ™μ΄ ν„μ¬ μƒν™©μ— λ¶€μ ν•©ν•λ‹¤κ³  νλ‹¨λλ‹¤λ©΄ κ³Όκ°ν•κ² μ›μΉ™μ„ λ¬΄μ‹ν•λΌ.

### π”– 6.3.1 λ””λ―Έν„° λ²•μΉ™μ€ ν•λ‚μ λ„νΈ(.)λ¥Ό κ°•μ ν•λ” κ·μΉ™μ΄ μ•„λ‹λ‹¤

`IntStream.of(1, 15, 20, 3, 9).filter(x -> x > 10).distinct().count();`

- μ„ μ½”λ“λ” λ™μΌν• ν΄λμ¤μ μΈμ¤ν„΄μ¤λ¥Ό λ°ν™ν•λ―€λ΅ λ””λ―Έν„° λ²•μΉ™μ„ μ„λ°ν•μ§€ μ•λ”λ‹¤.
- κΈ°μ°¨ μ¶©λμ²λΌ λ³΄μ΄λ” μ½”λ“λΌλ„ κ°μ²΄μ λ‚΄λ¶€ κµ¬ν„μ— λ€ν• μ–΄λ–¤ μ •λ³΄λ„ μ™Έλ¶€λ΅ λ…Έμ¶ν•μ§€ μ•λ”λ‹¤λ©΄ κ·Έκ²ƒμ€ λ””λ―Έν„° λ²•μΉ™μ„ μ¤€μν• κ²ƒμ΄λ‹¤.

### π”– 6.3.2 κ²°ν•©λ„μ™€ μ‘μ§‘λ„μ μ¶©λ

- λ¨λ“  μƒν™©μ—μ„ λ§Ήλ©μ μΌλ΅ μ„μ„ λ©”μ„λ“λ¥Ό μ¶”κ°€ν•λ©΄ κ°™μ€ νΌλΈ”λ¦­ μΈν„°νμ΄μ¤ μ•μ— μ–΄μΈλ¦¬μ§€ μ•λ” μ¤νΌλ μ΄μ…λ“¤μ΄ κ³µμ΅΄ν•κ² λλ‹¤. κ²°κ³Όμ μΌλ΅ μ‘μ§‘λ„ β¬‡οΈ
- κ°€λ”μ”©μ€ λ¬»λ” κ²ƒ μ™Έμ—λ” λ‹¤λ¥Έ λ°©λ²•μ΄ μ΅΄μ¬ν•μ§€ μ•λ” κ²½μ°λ„ μλ‹¤.
  - μ»¬λ ‰μ…μ— ν¬ν•¨λ κ°μ²΄λ“¤μ„ μ²λ¦¬ν•λ” μ μΌν• λ°©λ²•μ€ κ°μ²΄μ—κ² λ¬Όμ–΄λ³΄λ” κ²ƒ
  - λ¬»λ” λ€μƒμ΄ μλ£ κµ¬μ΅°λΌλ©΄ λ‹Ήμ—°ν λ‚΄λ¶€λ¥Ό λ…Έμ¶ν•΄μ•Ό ν•λ―€λ΅ λ””λ―Έν„° λ²•μΉ™μ„ μ μ©ν•  ν•„μ”κ°€ μ—†λ‹¤.

μ„¤κ³„λ” trade-offμ μ‚°λ¬Όμ΄λ‹¤. μ¦‰, κ²½μ°μ— λ”°λΌ λ‹¤λ¥΄λ‹¤

μ›μΉ™μ΄ μ μ ν• μƒν™©κ³Ό λ¶€μ μ ν• μƒν™©μ„ νλ‹¨ν•  μ μλ” μ•λ©μ„ κΈΈλ¬λΌβ—οΈ

## π“– 6.4 λ…λ Ή-μΏΌλ¦¬ λ¶„λ¦¬ μ›μΉ™

- **λ£¨ν‹΄(routine)**: μ–΄λ–¤ μ μ°¨λ¥Ό λ¬¶μ–΄ νΈμ¶ κ°€λ¥ν•λ„λ΅ μ΄λ¦„μ„ λ¶€μ—¬ν• κΈ°λ¥ λ¨λ“
  - **ν”„λ΅μ‹μ €(procedure)**μ™€ **ν•¨μ(function)**λ΅ κµ¬λ¶„
- ν”„λ΅μ‹μ €(procedure): μ •ν•΄μ§„ μ μ°¨μ— λ”°λΌ λ‚΄λ¶€μ μƒνƒλ¥Ό λ³€κ²½ν•λ” λ£¨ν‹΄μ ν• μΆ…λ¥
  - λ¶€μν¨κ³Όλ¥Ό λ°μƒμ‹ν‚¬ μ μμ§€λ§ κ°’μ„ λ°ν™ν•  μ μ—†λ‹¤.
  - κ°μ²΄μ μΈν„°νμ΄μ¤ μΈ΅λ©΄μ—μ„ **λ…λ Ή(Command)**μ™€ λ™μΌ
- ν•¨μ(function): μ–΄λ–¤ μ μ°¨μ— λ”°λΌ ν•„μ”ν• κ°’μ„ κ³„μ‚°ν•΄μ„ λ°ν™ν•λ” λ£¨ν‹΄μ ν• μΆ…λ¥
  - κ°’μ„ λ°ν™ν•  μ μμ§€λ§ λ¶€μν¨κ³Όλ¥Ό λ°μƒμ‹ν‚¬ μ μ—†λ‹¤.
  - κ°μ²΄μ μΈν„°νμ΄μ¤ μΈ΅λ©΄μ—μ„ **μΏΌλ¦¬(Query)**μ™€ λ™μΌ

λ…λ Ή-μΏΌλ¦¬ λ¶„λ¦¬ μ›μΉ™μ μ”μ§€λ” μ¤νΌλ μ΄μ…μ€ λ¶€μν¨κ³Όλ¥Ό λ°μƒμ‹ν‚¤λ” λ…λ Ήμ΄κ±°λ‚ λ¶€μν¨κ³Όλ¥Ό λ°μƒμ‹ν‚¤μ§€ μ•λ” μΏΌλ¦¬ μ¤‘ ν•λ‚μ—¬μ•Ό ν•λ‹¤λ” κ²ƒ

- κ°μ²΄μ μƒνƒλ¥Ό λ³€κ²½ν•λ” λ…λ Ήμ€ λ°ν™κ°’μ„ κ°€μ§ μ μ—†λ‹¤.
- κ°μ²΄μ μ •λ³΄λ¥Ό λ°ν™ν•λ” μΏΌλ¦¬λ” μƒνƒλ¥Ό λ³€κ²½ν•  μ μ—†λ‹¤.
- "μ§λ¬Έμ΄ λ‹µλ³€μ„ μμ •ν•΄μ„λ” μ• λλ‹¤"

### π”– 6.4.1 λ°λ³µ μΌμ •μ λ…λ Ήκ³Ό μΏΌλ¦¬ λ¶„λ¦¬ν•κΈ°

μμ‹ λ„λ©”μΈμ μ©μ–΄ μ •λ¦¬

- μ΄λ²¤νΈ: νΉμ • μΌμμ— μ‹¤μ λ΅ λ°μƒν•λ” μ‚¬κ±΄
- λ°λ³µ μΌμ •: μΌμ£ΌμΌ λ‹¨μ„λ΅ λμ•„μ¤λ” νΉμ • μ‹κ°„ κ°„κ²©μ— λ°μƒν•λ” μ‚¬κ±΄ μ „μ²΄λ¥Ό ν¬κ΄„μ μΌλ΅ μ§€μΉ­

```java
@AllArgsConstructor
public class Event {

    private String subject;
    private LocalDateTime from;
    private Duration duration;
}
```

```java
@AllArgsConstructor
public class RecurringSchedule {
    
    private String subject;
    
    @Getter
    private DayOfWeek dayOfWeek;
    
    @Getter
    private LocalTime from;
    
    @Getter
    private Duration duration;
}
```

```java
RecurringSchedule schedule = new RecurringSchedule("νμ", DayOfWeek.WEDNESDAY, LocalTime.of(10, 30), Duration.ofMinutes(30));
Event meeting = new Event("νμ", LocalDateTime.of(2019, 5, 8, 10, 30), Duration.ofMinutes(30));

assert meeting.isSatisfied(schedule);
```

- μ„ μ½”λ“λ” λ‹Ήμ—°ν trueλ¥Ό λ°ν™ν•λ‹¤.

```java
RecurringSchedule schedule = new RecurringSchedule("νμ", DayOfWeek.WEDNESDAY, LocalTime.of(10, 30), Duration.ofMinutes(30));
Event meeting = new Event("νμ", LocalDateTime.of(2019, 5, 9, 10, 30), Duration.ofMinutes(30));

assert !meeting.isSatisfied(schedule);
assert meeting.isSatisfied(schedule);
```

- 5/9λ” λ©μ”μΌμ΄λ―€λ΅ `false`λ¥Ό λ°ν™ν•λ‹¤. ν•μ§€λ§ λ‹¤μ‹ ν•λ² λ” μ‹¤ν–‰μ‹ν‚¤λ©΄ `true`λ¥Ό λ°ν™ν•λ‹¤.

```java
@AllArgsConstructor
public class Event {

    private String subject;
    private LocalDateTime from;
    private Duration duration;

    public boolean isSatisfied(RecurringSchedule schedule) {
        if (from.getDayOfWeek() != schedule.getDayOfWeek() || !from.toLocalTime().equals(schedule.getFrom()) || !duration.equals(schedule.getDuration())) {
            reschedule(schedule);
            return false;
        }
        return true;
    }
    
    private void reschedule(RecurringSchedule schedule) {
        from = LocalDateTime.of(from.toLocalDate().plusDays(daysDistance(schedule)), schedule.getFrom());
        duration = schedule.getDuration();
    }
    
    private long daysDistance(RecurringSchedule schedule) {
        return schedule.getDayOfWeek().getValue() - from.getDayOfWeek().getValue();
    }
}
```

- `isSatisfied`κ°€ λ…λ Ήκ³Ό μΏΌλ¦¬μ λ‘ κ°€μ§€ μ—­ν• μ„ λ™μ‹μ— μν–‰ν•κ³  μμ—κΈ° λ•λ¬Έμ— λ°μƒν• λ¬Έμ 
- λ…λ Ήκ³Ό μΏΌλ¦¬λ¥Ό λ’¤μ„μΌλ©΄ μ‹¤ν–‰ κ²°κ³Όλ¥Ό μμΈ΅ν•κΈ°κ°€ μ–΄λ ¤μ›μ§ μ μλ‹¤.

```java
@AllArgsConstructor
public class Event {

    private String subject;
    private LocalDateTime from;
    private Duration duration;

    public boolean isSatisfied(RecurringSchedule schedule) {
        return from.getDayOfWeek() == schedule.getDayOfWeek() && from.toLocalTime().equals(schedule.getFrom()) && duration.equals(schedule.getDuration());
    }

    public void reschedule(RecurringSchedule schedule) {
        from = LocalDateTime.of(from.toLocalDate().plusDays(daysDistance(schedule)), schedule.getFrom());
        duration = schedule.getDuration();
    }

    private long daysDistance(RecurringSchedule schedule) {
        return schedule.getDayOfWeek().getValue() - from.getDayOfWeek().getValue();
    }
}
```

- μ΄λ ‡κ² λ¶„λ¦¬κ°€ λμ–΄ `reschedule` λ©”μ„λ“ νΈμ¶μ—¬λ¶€λ¥Ό `Event`λ¥Ό μ‚¬μ©ν•λ” μ½μ—μ„ κ²°μ •ν•  μ μλ‹¤.
- μμΈ΅ κ°€λ¥ν•κ³  μ΄ν•΄ν•κΈ° μ‰¬μ°λ©° λ””λ²„κΉ…μ΄ μ©μ΄ν• λ™μ‹μ— μ μ§€λ³΄μκ°€ μμ›”ν•΄μ§ κ²ƒ

### π”– 6.4.2 λ…λ Ή-μΏΌλ¦¬ λ¶„λ¦¬μ™€ μ°Έμ΅° ν¬λ…μ„±

λ…λ Ήκ³Ό μΏΌλ¦¬λ¥Ό λ¶„λ¦¬ν•¨μΌλ΅μ¨ λ…λ Ήν• μ–Έμ–΄μ ν‹€ μ•μ—μ„ **μ°Έμ΅° ν¬λ…μ„±(referential transparency)**μ μ¥μ μ„ μ ν•μ μ΄λ‚λ§ λ„λ¦΄ μ μκ² λλ‹¤.

- μ°Έμ΅° ν¬λ…μ„±μ΄λ€ μ–΄λ–¤ ν‘ν„μ‹ eκ°€ μμ„ λ• eμ κ°’μΌλ΅ eκ°€ λ‚νƒ€λ‚λ” λ¨λ“  μ„μΉλ¥Ό κµμ²΄ν•λ”λΌλ„ κ²°κ³Όκ°€ λ‹¬λΌμ§€μ§€ μ•λ” νΉμ„±
- μ°Έμ΅° ν¬λ…μ„±μ„ μ ν™μ©ν•λ©΄ λ²„κ·Έκ°€ μ κ³ , λ””λ²„κΉ…μ΄ μ©μ΄ν•λ©°, μΏΌλ¦¬μ μμ„μ— λ”°λΌ μ‹¤ν–‰ κ²°κ³Όκ°€ λ³€ν•μ§€ μ•λ” μ½”λ“λ¥Ό μ‘μ„±ν•  μ μλ‹¤.
- μ»΄ν“¨ν„°μ μ„Έκ³„μ™€ μν•™μ μ„Έκ³„λ¥Ό λ‚λ„λ” κ°€μ¥ ν° νΉμ§•μ€ **λ¶€μν¨κ³Ό(side effect)** μ μ΅΄μ¬ μ λ¬΄λ‹¤.
- μ–΄λ–¤ κ°’μ΄ λ³€ν•μ§€ μ•λ” μ„±μ§μ„ **λ¶λ³€μ„±(immutability)** μ΄λΌκ³  λ¶€λ¥Έλ‹¤.

μ°Έμ΅° ν¬λ…μ„±μ„ λ§μ΅±ν•λ” μ‹μ€ μ°λ¦¬μ—κ² λ‘ κ°€μ§€ μ¥μ μ„ μ κ³µ

1. λ¨λ“  ν•¨μλ¥Ό μ΄λ―Έ μ•κ³  μλ” ν•λ‚μ κ²°κ΄κ°’μΌλ΅ λ€μ²΄ν•  μ μκΈ° λ•λ¬Έμ— μ‹μ„ μ‰½κ² κ³„μ‚°ν•  μ μλ‹¤.
2. λ¨λ“  κ³³μ—μ„ ν•¨μμ κ²°κ΄κ°’μ΄ λ™μΌν•κΈ° λ•λ¬Έμ— μ‹μ μμ„λ¥Ό λ³€κ²½ν•λ”λΌλ„ κ° μ‹μ κ²°κ³Όλ” λ‹¬λΌμ§€μ§€ μ•λ”λ‹¤.

### π”– 6.4.3 μ±…μ„μ— μ΄μ μ„ λ§μ¶°λΌ

λ©”μ‹μ§€λ¥Ό λ¨Όμ € μ„ νƒν•κ³  κ·Έ ν›„μ— λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•  κ°μ²΄λ¥Ό μ„ νƒν•λΌ.

- λ””λ―Έν„° λ²•μΉ™
  - ν‘λ ¥μ΄λΌλ” μ»¨ν…μ¤νΈ μ•μ—μ„ κ°μ²΄λ³΄λ‹¤ λ©”μ‹μ§€λ¥Ό λ¨Όμ € κ²°μ •ν•λ©΄ λ‘ κ°μ²΄ μ‚¬μ΄μ κµ¬μ΅°μ μΈ κ²°ν•©λ„λ¥Ό λ‚®μ¶ μ μλ‹¤.
- λ¬»μ§€ λ§κ³  μ‹μΌλΌ
  - λ©”μ‹μ§€λ¥Ό λ¨Όμ € μ„ νƒν•λ©΄ ν‘λ ¥μ„ κµ¬μ΅°ν™”ν•κ² λλ‹¤.
- μλ„λ¥Ό λ“λ¬λ‚΄λ” μΈν„°νμ΄μ¤
  - λ©”μ‹μ§€λ¥Ό λ¨Όμ € μ„ νƒν•λ‹¤λ” κ²ƒμ€ λ©”μ‹μ§€λ¥Ό μ „μ†΅ν•λ” ν΄λΌμ΄μ–ΈνΈμ κ΄€μ μ—μ„ λ©”μ‹μ§€μ μ΄λ¦„μ„ μ •ν•λ‹¤λ” κ²ƒ
- λ…λ Ή-μΏΌλ¦¬ λ¶„λ¦¬ μ›μΉ™
  - λ©”μ‹μ§€λ¥Ό λ¨Όμ € μ„ νƒν•λ‹¤λ” κ²ƒμ€ ν‘λ ¥μ΄λΌλ” λ¬Έλ§¥ μ•μ—μ„ κ°μ²΄μ μΈν„°νμ΄μ¤μ— κ΄€ν•΄ κ³ λ―Όν•λ‹¤λ” κ²ƒμ„ μλ―Έ

ν‘λ ¥μ„ μ„ν•΄ λ‘ κ°μ²΄κ°€ λ³΄μ¥ν•΄μ•Ό ν•λ” μ‹¤ν–‰ μ‹μ μ μ μ•½μ„ μΈν„°νμ΄μ¤μ— λ…μ‹ν•  μ μλ” λ°©λ²•μ΄ μ΅΄μ¬ν•μ§€ μ•μ.

- μ‹κ·Έλ‹μ²μ—λ” μ–΄λ–¤ μ΅°κ±΄μ΄ λ§μ΅±λΌμ•Όλ§ μ¤νΌλ μ΄μ…μ„ νΈμ¶ν•  μ μκ³  μ–΄λ–¤ κ²½μ°μ— κ²°κ³Όλ¥Ό λ°ν™λ°›μ„ μ μ—†λ”μ§€λ¥Ό ν‘ν„ν•  μ μ—†λ‹¤.
- μ΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ **κ³„μ•½μ— μν• μ„¤κ³„(Design By Contract)** κ°λ…μ΄ λ‚μ΄.
